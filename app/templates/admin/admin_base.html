<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Admin Panel{% endblock %}</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <style>
      :root {
        --sidebar-width: 250px;
        --primary-color: #ffc107;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: var(--sidebar-width);
        background: #2c3e50;
        color: #ecf0f1;
        overflow-y: auto;
        transition: all 0.3s;
        z-index: 1000;
      }

      .sidebar-brand {
        padding: 1.5rem;
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-color);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar-nav {
        padding: 1rem 0;
      }

      .sidebar-nav .nav-link {
        color: #ecf0f1;
        padding: 0.75rem 1.5rem;
        transition: all 0.3s;
        border-left: 3px solid transparent;
      }

      .sidebar-nav .nav-link:hover,
      .sidebar-nav .nav-link.active {
        background: rgba(255, 193, 7, 0.1);
        border-left-color: var(--primary-color);
        color: var(--primary-color);
      }

      .sidebar-nav .nav-link i {
        width: 20px;
        margin-right: 10px;
      }

      .main-content {
        margin-left: var(--sidebar-width);
        min-height: 100vh;
        background: #f8f9fa;
      }

      .top-bar {
        background: #fff;
        padding: 1rem 2rem;
        border-bottom: 1px solid #dee2e6;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .content-wrapper {
        padding: 2rem;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-card.warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .stat-card.success {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .stat-card.info {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      }

      .card {
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        border-radius: 10px;
      }

      .table-actions a {
        margin: 0 0.25rem;
      }

      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.show {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }
      }
    </style>

    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-brand">
        <i class="bi bi-speedometer2"></i> Admin Panel
      </div>

      <ul class="sidebar-nav nav flex-column">
        <li class="nav-item">
          <a
            class="nav-link {% if request.endpoint == 'admin.dashboard' %}active{% endif %}"
            href="{{ url_for('admin.dashboard') }}"
          >
            <i class="bi bi-house-door"></i> Dashboard
          </a>
        </li>

        <!-- ===== CHỈ ADMIN MỚI THẤY ===== -->
        {% if current_user.is_admin %}
        <li class="nav-item">
          <hr class="bg-light" />
        </li>
        <li class="nav-item">
          <a
            class="nav-link {% if 'users' in request.endpoint %}active{% endif %}"
            href="{{ url_for('admin.users') }}"
          >
            <i class="bi bi-people"></i> Người dùng
          </a>
        </li>
        {% endif %}

        <li class="nav-item">
          <hr class="bg-light" />
        </li>
        <!-- ===== CHỨC NĂNG USER THƯỜNG ===== -->
        <li class="nav-item">
          <a
            class="nav-link {% if 'categories' in request.endpoint %}active{% endif %}"
            href="{{ url_for('admin.categories') }}"
          >
            <i class="bi bi-tag"></i> Danh mục
          </a>
        </li>

        <li class="nav-item">
          <a
            class="nav-link {% if 'contacts' in request.endpoint %}active{% endif %}"
            href="{{ url_for('admin.contacts') }}"
          >
            <i class="bi bi-envelope"></i> Liên hệ {% if total_contacts and
            total_contacts > 0 %}
            <span class="badge bg-danger ms-2">{{ total_contacts }}</span>
            {% endif %}
          </a>
        </li>

        <li class="nav-item">
          <a
            class="nav-link {% if 'products' in request.endpoint %}active{% endif %}"
            href="{{ url_for('admin.products') }}"
          >
            <i class="bi bi-box-seam"></i> Sản phẩm
          </a>
        </li>

        <li class="nav-item">
          <a
            class="nav-link {% if 'media' in request.endpoint %}active{% endif %}"
            href="{{ url_for('admin.media') }}"
          >
            <i class="bi bi-folder2-open"></i> Media Library
          </a>
        </li>

        <li class="nav-item">
          <a
            class="nav-link {% if 'banners' in request.endpoint %}active{% endif %}"
            href="{{ url_for('admin.banners') }}"
          >
            <i class="bi bi-images"></i> Banner
          </a>
        </li>

        <li class="nav-item">
          <a
            class="nav-link {% if 'blogs' in request.endpoint %}active{% endif %}"
            href="{{ url_for('admin.blogs') }}"
          >
            <i class="bi bi-newspaper"></i> Tin tức
          </a>
        </li>

        <li class="nav-item">
          <a
            class="nav-link {% if 'faqs' in request.endpoint %}active{% endif %}"
            href="{{ url_for('admin.faqs') }}"
          >
            <i class="bi bi-question-circle"></i> FAQ
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            href="{{ url_for('main.index') }}"
            target="_blank"
          >
            <i class="bi bi-globe"></i> Xem Website
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('admin.logout') }}">
            <i class="bi bi-box-arrow-right"></i> Đăng xuất
          </a>
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Top Bar -->
      <div class="top-bar d-flex justify-content-between align-items-center">
        <div>
          <button class="btn btn-link d-md-none" id="sidebarToggle">
            <i class="bi bi-list fs-4"></i>
          </button>
          <h4 class="mb-0 d-inline">
            {% block page_title %}Dashboard{% endblock %}
          </h4>
        </div>

        <div class="dropdown">
          <button
            class="btn btn-link dropdown-toggle text-decoration-none"
            type="button"
            data-bs-toggle="dropdown"
          >
            <i class="bi bi-person-circle fs-5"></i>
            <span class="ms-2">{{ current_user.username }}</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <a class="dropdown-item" href="{{ url_for('admin.dashboard') }}">
                <i class="bi bi-speedometer2"></i> Dashboard
              </a>
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <a class="dropdown-item" href="{{ url_for('admin.logout') }}">
                <i class="bi bi-box-arrow-right"></i> Đăng xuất
              </a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %}
      <div class="content-wrapper">
        {% for category, message in messages %}
        <div
          class="alert alert-{{ category }} alert-dismissible fade show"
          role="alert"
        >
          {{ message }}
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
          ></button>
        </div>
        {% endfor %}
      </div>
      {% endif %} {% endwith %}

      <!-- Content -->
      <div class="content-wrapper">{% block content %}{% endblock %}</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Sidebar toggle for mobile
      document
        .getElementById("sidebarToggle")
        ?.addEventListener("click", function () {
          document.querySelector(".sidebar").classList.toggle("show");
        });

      // Confirm delete
      document.querySelectorAll("[data-confirm]").forEach(function (element) {
        element.addEventListener("click", function (e) {
          if (!confirm(this.dataset.confirm || "Bạn có chắc chắn muốn xóa?")) {
            e.preventDefault();
          }
        });
      });
    </script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
